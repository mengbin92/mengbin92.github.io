---
layout: post
title: EIP-1599简介
tags: ethereum
mermaid: false
math: false
---  

**EIP-1559** 是以太坊网络上的一项重要升级，它是 **伦敦硬分叉（London Hard Fork）** 的一部分，于 **2021年8月5日** 在以太坊主网生效。EIP-1559 引入了一种全新的 **交易费用模型**，旨在改善以太坊交易的 **可预测性** 和 **效率**，并通过 **销毁一部分交易费用** 来减少以太坊的 **通货膨胀**。

EIP-1559 的主要目标是减少用户在网络拥堵时所支付的交易费用波动，并使交易费用变得更加 **透明** 和 **可预测**。这个提案还包括了一些重要的机制，如 **基本费用（Base Fee）** 和 **优先费用（Tip）**，以及在网络繁忙时 **自动调整基本费用** 的能力。

---

### EIP-1559 的关键特性

1. **基本费用（Base Fee）**：  
   在 EIP-1559 模式下，交易费用不再由用户设置单一的 `gasPrice`。相反，网络会自动计算一个 **基本费用（base fee）**，这是交易处理的基本费用。这个费用是根据当前区块的 **拥堵程度** 来动态调整的。每个区块的基本费用都由网络根据 **区块的填充度** 来计算，填充度较高时基本费用会增加，反之则降低。
   - **基本费用的计算**：  
     基本费用的变化是渐进的，每个区块的基本费用都会向目标 `gasTarget` （即区块目标的填充度）进行调整。目标是使得每个区块的交易填充程度保持在大约 **50%**。如果某个区块的填充度超过 50%，基本费用会增加，反之则会减少。
   - **基本费用的销毁**：  
     基本费用会被销毁，而不会支付给矿工。销毁的机制意味着 **以太坊的总供应量会减少**，这对于长期来看对抑制通货膨胀有积极影响。

2. **小费（Tip）或优先费用（Priority Fee）**：
   除了基本费用之外，用户可以为交易支付额外的小费，来激励矿工优先处理自己的交易。这部分费用称为 **优先费用（priority fee）** 或 **小费（tip）**。用户可以通过设置这个费用来增加交易的处理优先级。矿工会将这部分小费作为他们的报酬，而不会销毁。
   - **优先费用的设置**：  
     用户可以在提交交易时设置一个额外的 **`maxPriorityFeePerGas`**，来为矿工提供额外的小费。
   
3. **最大费用（Max Fee）**：  
   这是用户愿意支付的最高费用上限，包括 **基本费用（base fee）** 和 **优先费用（tip）**。用户在提交交易时会设定这个上限，来确保交易费用不会超过自己的预算。
   - 例如，假设当前区块的基本费用为 50 Gwei，用户设置了最大费用为 100 Gwei，并设置了优先费用为 20 Gwei，那么最终交易费用会是 70 Gwei（50 Gwei 基本费用 + 20 Gwei 优先费用），并且用户支付的费用不会超过 100 Gwei。

4. **自动调整费用**：  
   基本费用会根据区块填充度进行自动调整，使得以太坊网络能够适应动态的需求。如果网络需求增加，基本费用会上升；如果需求下降，基本费用就会降低。这意味着用户在发起交易时可以更好地预见到自己需要支付的费用，而不必像传统模型那样每次都猜测。

---

### EIP-1559 的工作原理

1. **网络计算基本费用**：
   每个区块的基本费用会根据网络当前的拥堵情况进行自动调整。它是动态的，并且会随着区块的填充程度逐渐变化。具体来说：
   - 如果当前区块的使用率（交易数量与区块容量的比率）高于目标值（50%），则下一个区块的基本费用将增加。
   - 如果当前区块的使用率低于目标值，则下一个区块的基本费用将减少。
   
   通过这种方式，EIP-1559 试图让网络始终保持在一个合理的负载水平，避免交易费用的剧烈波动。

2. **用户设置费用**：
   在 EIP-1559 模式下，用户提交交易时，除了设置普通的 `gasLimit` 外，还需要设置以下几个重要参数：
   - `maxFeePerGas`：这是用户愿意支付的 **最大总费用**，包括基本费用和优先费用。
   - `maxPriorityFeePerGas`：这是用户愿意支付的 **矿工优先费用（小费）**，它会直接支付给矿工，以提高交易的优先级。

3. **费用计算**：
   - 交易费用的计算如下：
     \[
     \text{Total Transaction Fee} = \text{Base Fee} + \text{Priority Fee}
     \]
   - 例如，如果基本费用是 50 Gwei，而用户设置的优先费用为 10 Gwei，那么矿工将获得 10 Gwei 的小费，剩余的 50 Gwei 将被销毁。

4. **交易费用的销毁**：
   - 基本费用部分会被销毁，即不会支付给矿工。这一机制减少了以太坊的供应量，起到了类似于 **燃烧** 的效果，有助于减缓通货膨胀。

---

### EIP-1559 的优点

1. **更可预测的交易费用**：在传统的以太坊交易模型中，用户需要根据当前的网络拥堵情况手动设置 `gasPrice`。这导致了交易费用的波动，尤其是在网络拥堵时，费用可能非常高。而在 EIP-1559 模式下，基本费用的自动调整机制使得交易费用更加可预测，用户可以更清晰地知道自己需要支付多少费用。
2. **降低用户手续费波动**：通过自动调整基本费用，EIP-1559 能够减少高峰时段手续费的大幅波动，从而使得交易费用在不同网络负载下变得更平滑。
3. **提高矿工收入的公平性**：通过 **优先费用（tip）**，矿工可以直接获得来自用户的小费，而不仅仅依赖于块奖励。用户设置的优先费用帮助矿工更公平地分配收入。
4. **通缩效应**：基本费用的销毁机制导致了以太坊总供应量的减少。这种销毁机制使得以太坊的供应量逐渐减少，从而有助于对抗通货膨胀，长期来看对以太坊的价值有潜在的支撑作用。

---

### EIP-1559 的挑战和争议

1. **矿工的反应**：在 EIP-1559 升级之前，矿工的收入主要来源于 `gasPrice`。而 EIP-1559 引入的 **基本费用销毁** 机制意味着矿工只能从 **优先费用（tip）** 中获得报酬，这可能导致矿工收入的不稳定。在实施初期，一些矿工表达了对该提案的反对，认为这会削弱他们的收入来源。
2. **对高价值交易的影响**：对于一些高价值的交易，尤其是在网络繁忙时，用户可能需要支付更高的 `maxPriorityFeePerGas` 来确保交易能够尽快被处理。尽管 EIP-1559 使得费用更加可预测，但在某些情况下，用户仍然需要支付较高的费用。

---

**EIP-1559** 是以太坊网络上一个具有里程碑意义的改进提案，它引入了 **基本费用** 和 **优先费用** 的概念，并通过 **自动调整费用** 和 **销毁部分费用** 来优化交易费用模型。通过这种方式，EIP-1559 提供了更高的费用透明度和可预测性，减少了交易费用的波动，并为以太坊网络带来了长期的 **通缩效应**。虽然它对矿工的收入模式产生了一些影响，但从用户体验和网络效率的角度来看，这一提案显著改善了以太坊的交易费用结构。

---

<div align="center">
  <img src="../img/qrcode_wechat.jpg" alt="孟斯特">
</div>

> 声明：本作品采用[署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)进行许可，使用时请注明出处。  
> Author: [mengbin](mengbin1992@outlook.com)  
> blog: [mengbin](https://mengbin.top)  
> Github: [mengbin92](https://mengbin92.github.io/)  
> cnblogs: [恋水无意](https://www.cnblogs.com/lianshuiwuyi/)  
> 腾讯云开发者社区：[孟斯特](https://cloud.tencent.com/developer/user/6649301)  
---