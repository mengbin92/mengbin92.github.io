---
layout: post
title: web3.jså®ç”¨å‡½æ•°
tags: [blockchain, web3.js]
mermaid: false
math: false
---  

> åŸæ–‡åœ¨[è¿™é‡Œ](https://docs.web3js.org/guides/web3_utils_module/mastering_web3-utils)

## ä»‹ç»
åœ¨è¿™ä¸ªæŒ‡å—ä¸­ï¼Œä½ å°†å­¦ä¹ åˆ°web3 utilsåŒ…çš„ä¸åŒå‡½æ•°ï¼Œå®ƒåŒ…å«äº†å¦‚ä½•ä»¥ä¸åŒæ ¼å¼ç”Ÿæˆéšæœºå­—èŠ‚ï¼Œå¦‚ä½•åœ¨Hexå€¼å’Œæ•°å­—ä¹‹é—´è¿›è¡Œè½¬æ¢ï¼Œå“ˆå¸Œå‡½æ•°ï¼Œåœ°å€ï¼Œæ‰“åŒ…å¡«å……çš„æ–¹æ³•ï¼Œæœ€åä½ å°†çœ‹åˆ°å¦‚ä½•æ¯”è¾ƒåŒºå—å·ã€‚  

## å®‰è£… 

åªå®‰è£…web3å·¥å…·åŒ…ï¼š

```bash
$ npm i web3-utils
```

æˆ–è€…ä½ ä¹Ÿå¯ä»¥å®‰è£…web3åº“ï¼Œç„¶åè®¿é—®`web3.utils`ï¼š

```bash
$ npm i web3
```  

## å¯¼å…¥  

æœ‰ä¸‰ç§ä¸åŒçš„æ–¹å¼æ¥å¯¼å…¥`utils`åŒ…ã€‚  

### å¯¼å…¥å®Œæ•´çš„webåº“  

```javascript
// import web3 module
import { Web3 } from "web3";

// no need to initialize a provider
Web3.utils.toHex("web3");
//=> 0x77656233

// initializing  a provider
const web3 = new Web3("https:// eth.llamarpc.com");

// access the utils package
web3.utils.toHex("web3");
//=> 0x77656233
```  

### å¯¼å…¥utilsæ¨¡å—

```javascript
// import utils module
import { utils } from "web3"; 

// access the utils package
utils.toWei("1", "ether")
```  

### å¯¼å…¥æŒ‡å®šæ–¹æ³•

```javascript
// import toWei and toHex functions
import { toWei, toHex } from"web3-utils";

// usage
toWei("1", "ether")
toHex("")
```  

## æ–¹æ³•ç¤ºä¾‹

### éšæœºHexå’ŒBytes

```javascript
// Random bytes in hex format and array format

console.log(web3.utils.randomBytes(32));
/* => array format
Uint8Array(32) [
  251,  70, 124,  65, 203, 180,  92, 234,
  210, 236,  72, 154,  83, 219, 171, 223,
  212, 136, 117, 140,  67, 117,  86,  81,
  234, 245, 148, 186, 175,  83,  98,  78
]
*/

console.log(web3.utils.randomHex(32));
/* => hex string format
0x594386dc9b2e150979416f9b2a093e01f84a37c4f8db5fc1b0d9b1dc83a12c1f
*/
``` 

> INFO
> å¦‚æœä½ ä¸ç»™å‡ºä»»ä½•å‚æ•°ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå‡½æ•°çš„é»˜è®¤å€¼éƒ½å°†ä¸º32ã€‚

### è½¬æ¢ - ä»¥å¤ªåŠé¢é¢

æˆ‘ä»¬æœ‰ä¸¤ä¸ªä¸åŒçš„å‡½æ•°æ¥è¿›è¡Œä»¥å¤ªåŠé¢é¢ä¹‹é—´çš„è½¬æ¢ã€‚  

```javascript
console.log(web3.utils.fromWei("1", "ether")); 
// 0.000000000000000001

console.log(web3.utils.toWei("1", "ether")); 
// 1_000_000_000_000_000_000
```  

### è½¬æ¢Hexå˜é‡  

```javascript
// most versatile one
console.log(web3.utils.toHex(10));
// 0xa

console.log(web3.utils.toHex(true));
// 0x01

console.log(web3.utils.numberToHex(10));
// 0xa

console.log(web3.utils.fromDecimal(10));
// 0xa

const arr = new Uint8Array([1, 2, 3, 4]);

console.log(web3.utils.toHex(arr));
// 0x7b2230223a312c2231223a322c2232223a332c2233223a347d

console.log(web3.utils.bytesToHex(arr));
// 0x01020304
```  

### è½¬æ¢UTFå’ŒASCII

```javascript
console.log(web3.utils.utf8ToHex("ğŸ˜Š"));
// 0xf09f988a

console.log(web3.utils.fromUtf8("ğŸ˜Š"));
// 0xf09f988a

console.log(web3.utils.asciiToHex("ğŸ˜Š"));
// 0xd83dde0a

console.log(web3.utils.toUtf8("0xf09f988a"));
// ğŸ˜Š

console.log(web3.utils.hexToUtf8("0xf09f988a"));
// ğŸ˜Š

console.log(web3.utils.hexToString("0xf09f988a"));
// ğŸ˜Š

// emojis are not ASCII character, that's why it won't work
console.log(web3.utils.toAscii("0x4869"));
// Hi

console.log(web3.utils.hexToAscii("0x4869"));
// Hi
```  

### è½¬æ¢ - æ•°å­—å’ŒBigint

```javascript
console.log(web3.utils.toNumber("0xa"));
// 10 (number)

console.log(web3.utils.hexToNumber("0xa"));
// 10 (number)

console.log(web3.utils.toDecimal("0xa"));
// 10 (number)

console.log(web3.utils.hexToNumberString("0xa"));
// 10 (string)

console.log(web3.utils.toBigInt("0xa")); 
// 10n (bigint)
```  

### å“ˆå¸Œå‡½æ•°

```javascript
// both will return undefined if an empty string is passed as an argument
console.log(web3.utils.sha3("hello web3"));
// 0x6c171485a0138b7b0a49d72b570e1d9c589d42a79ae57329d90671d1ac702d74

console.log(web3.utils.soliditySha3({ type: "string", value: "hello web3" }));
// 0x6c171485a0138b7b0a49d72b570e1d9c589d42a79ae57329d90671d1ac702d74
```  

### åœ°å€

```javascript
// isAddress() is deprecated so we can use toCheckSumAddress()
// to see if the hex string we are passing is a correct ethereum address

// passing an address with all characters lowercase
console.log(web3.utils.toChecksumAddress("0xa3286628134bad128faeef82f44e99aa64085c94"));
// 0xA3286628134baD128faeef82F44e99AA64085C94

// passing an wrong address
console.log(web3.utils.toChecksumAddress("0xa3286628134bad128faeef82f44e99aa64085c9"));
// InvalidAddressError: Invalid value given "0xa286628134bad128faeef82f44e99aa64085c94". Error: invalid ethereum address.
```  

### æ‰“åŒ…å’Œå¡«å……

```javascript
// same as abi.encodePacked() in solidity (must be strings)
// converts everything to hex and packs everything without padding
console.log(web3.utils.encodePacked("1", "1", "1"));
// 0x313131


// it will convert the number `10` to hex('a') and add 0s until it's 32 characters long
// the third argument will be the one that will fill/pad the whole hex string, in this case is '0'
console.log(web3.utils.padRight(10, 32, 0));
// 0xa0000000000000000000000000000000

console.log(web3.utils.rightPad(10, 32, 0));
// 0xa0000000000000000000000000000000

console.log(web3.utils.padLeft(10, 32, 0));
// 0x0000000000000000000000000000000a

console.log(web3.utils.leftPad(10, 32, 0));
// 0x0000000000000000000000000000000a
```  

### æ¯”è¾ƒåŒºå—å·

```javascript
// accepts numbers and formats as well
console.log(web3.utils.compareBlockNumbers("pending", "latest"));
// 1

console.log(web3.utils.compareBlockNumbers("latest", "pending"));
// -1

console.log(web3.utils.compareBlockNumbers("latest", "latest"));
// 0

console.log(web3.utils.compareBlockNumbers(2, 2));
// 0
```  

---

<div align="center">
  <img src="../img/qrcode_wechat.jpg" alt="å­Ÿæ–¯ç‰¹">
</div>

> å£°æ˜ï¼šæœ¬ä½œå“é‡‡ç”¨[ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™… (CC BY-NC-SA 4.0)](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)è¿›è¡Œè®¸å¯ï¼Œä½¿ç”¨æ—¶è¯·æ³¨æ˜å‡ºå¤„ã€‚  

> Author: [mengbin](mengbin1992@outlook.com)  

> blog: [mengbin](https://mengbin.top)  

> Github: [mengbin92](https://mengbin92.github.io/)  

> cnblogs: [æ‹æ°´æ— æ„](https://www.cnblogs.com/lianshuiwuyi/)  

> è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒºï¼š[å­Ÿæ–¯ç‰¹](https://cloud.tencent.com/developer/user/6649301)  

---
