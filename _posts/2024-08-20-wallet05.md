---
layout: post
title: 从0开始开发自己的BTC钱包：BTC分叉
tags: blockchain
mermaid: false
math: false
---  

## 什么是比特币分叉（BTC Fork）？

**比特币分叉**是指区块链网络在某些条件下产生分裂，导致出现两个或多个独立的区块链。这些分叉主要分为以下几种类型：

1. **硬分叉（Hard Fork）**：
   - 硬分叉是区块链协议的根本性改变，使得新规则与旧规则不兼容。
   - 硬分叉后，旧节点如果不升级将无法验证按照新规则产生的区块，最终会导致链的分裂。
   - 硬分叉产生后，区块链会分成两条不同的链，分别遵循不同的规则。
   - **例子**：比特币现金（BCH）就是从比特币（BTC）硬分叉出来的。
2. **软分叉（Soft Fork）**：
   - 软分叉是区块链协议的向后兼容性更新，即使节点不更新，它们仍然能够验证新规则下产生的区块。
   - 软分叉一般不会导致链的分裂，除非出现长时间的共识分歧。
   - **例子**：比特币的SegWit（隔离见证）就是一次软分叉。
3. **临时分叉（Temporary Fork）**：
   - 当多个矿工几乎同时挖出一个新区块时，可能会在短时间内出现临时的分叉。
   - 这种分叉通常在网络内经过几分钟的时间后通过最长链规则来解决，分叉较短的一条链上的区块和交易被丢弃。

## 如何确定主链？

在分叉发生后，如何确定哪条链是主链通常基于以下几个原则：

1. **最长链原则（Longest Chain Rule）**：
   - 比特币网络遵循“最长链规则”，即所有节点都会选择区块最多的一条链（即工作量证明最多的链）作为主链。
   - 当出现分叉时，矿工和节点会根据他们的共识算法来继续挖矿或验证交易，最终哪条链更长（或积累的难度更大），哪条链就会被全网接受为主链。
   - 短链上的区块会被废弃，其中包含的交易将被重新广播到网络中，并在主链中再次确认。
2. **工作量证明（Proof of Work, PoW）**：
   - 在比特币网络中，链的长度不仅是区块数量，还包括累计的工作量证明（即矿工为每个区块解决的难题）。
   - 矿工计算出的区块难度会随着时间调整，导致工作量证明更多的一条链会被认定为主链。
3. **社区共识**：
   - 社区的共识也会在确定主链中起到关键作用。尤其是在硬分叉的情况下，社区的大多数人（包括矿工、开发者、用户等）会决定支持哪条链作为主链。
   - 有时，社区会选择继续在旧链上进行交易和开发，这时原链也可能成为“主链”。

## 具体案例分析

1. **比特币和比特币现金的分叉**：
   - 2017年，比特币社区在区块大小问题上产生了分歧。一部分人主张保持区块大小1MB不变，通过SegWit提升扩展性，而另一部分人希望将区块大小增加至8MB，提升链上交易的处理能力。
   - 最终，这一争论导致了比特币在2017年8月1日进行硬分叉，比特币现金（BCH）由此诞生。
   - 分叉后，比特币网络继续保持1MB区块的链成为主链，原因是更多的算力支持了原链，并且原链得到了更多用户和交易所的支持。
2. **比特币和比特币黄金的分叉**：
   - 比特币黄金（BTG）是在2017年10月通过硬分叉从比特币网络中分离出来的，其主要目的是为了改变挖矿算法（从SHA-256改为Equihash），使普通用户也能参与挖矿。
   - 分叉后，比特币（BTC）链仍然被认为是主链，因为比特币网络的算力和共识依然集中在BTC上，而BTG则成为一条独立的链。

## 结论

比特币分叉是区块链网络中由于规则改变或社区分歧导致的链分裂现象。确定主链的标准主要依赖于最长链原则（即累计工作量证明最多的链），但在硬分叉的情况下，社区共识也起到了重要作用。分叉后的主链会继续承载比特币的价值和共识，而次链则会成为新的、独立的区块链。

---

<div align="center">
  <img src="../img/qrcode_wechat.jpg" alt="孟斯特">
</div>

> 声明：本作品采用[署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)进行许可，使用时请注明出处。  

> Author: [mengbin](mengbin1992@outlook.com)  

> blog: [mengbin](https://mengbin.top)  

> Github: [mengbin92](https://mengbin92.github.io/)  

> cnblogs: [恋水无意](https://www.cnblogs.com/lianshuiwuyi/)  

> 腾讯云开发者社区：[孟斯特](https://cloud.tencent.com/developer/user/6649301)  

---
