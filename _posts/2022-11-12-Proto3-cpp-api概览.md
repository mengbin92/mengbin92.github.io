---
layout: post
title: Proto3 cpp API概览
tags: [proto3, cpp, c++]
mermaid: false
---  

| 包名                                                                                                                     | 说明                              |
| :----------------------------------------------------------------------------------------------------------------------- | :-------------------------------- |
| [google::protobuf](https://developers.google.com/protocol-buffers/docs/reference/cpp#google.protobuf)                    | Protocol Buffer运行时库核心组件。 |
| [google::protobuf::io](https://developers.google.com/protocol-buffers/docs/reference/cpp#google.protobuf.io)             | I/O操作辅助类。                   |
| [google::protobuf::util](https://developers.google.com/protocol-buffers/docs/reference/cpp#google.protobuf.util)         | 工具类。                          |
| [google::protobuf::compiler](https://developers.google.com/protocol-buffers/docs/reference/cpp#google.protobuf.compiler) | Protocol Buffer编译器实现。       |

### google::protobuf  

Protocol Buffer运行时库核心组件。  

此包中的文件代表着Protocol Buffer系统的核心，它们都是libprotobuf库的组成。  

关于线程安全的注意事项：  

Protocol Buffer库的线程安全遵循一个简单的规则：除非显示地说明，只要对象在所有线程中声明为`const`，那么同时使用来自多个线程的对象总是安全的（或者，只有在声明为`const`的情况下才被允许使用）。但是，如果一个对象在一个线程中以不允许`const`的方式被访问，那么其它任何线程同时访问访问该对象都是不安全的。  

简单来说，在多线程中同时以只读的方式访问对象是允许的，但是同时只能有一个线程以写的方式访问对象。  

该实现确实包含一些`const`方法，这些方法实际上在后台修改对象 --- 例如，缓存结果 --- 但是在这些情况下，使用互斥锁使访问线程安全。  

| 文件                                                                                                                                                                                                                              | 说明                                                                                                                                                                                                                                                                                                           |
| :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [google/protobuf/arena.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.arena)                                                                                                                | 针对分配性能，文件定义了[Arena](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.arena#Arena)分配。                                                                                                                                                                           |
| [google/protobuf/descriptor.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.descriptor)                                                                                                      | 文件中包含描述protocol消息的类。                                                                                                                                                                                                                                                                               |
| [google/protobuf/descriptor.pb.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.descriptor.pb)                                                                                               | 描述符的Protocol Buffer表示。                                                                                                                                                                                                                                                                                  |
| [google/protobuf/descriptor_database.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.descriptor_database)                                                                                    | 操作描述符数据库的接口。                                                                                                                                                                                                                                                                                       |
| [google/protobuf/dynamic_message.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.arena](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.dynamic_message)) | 定义[消息](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.message#Message)的实现，该实现可以模拟编译时未知的类型的。                                                                                                                                                        |
| [google/protobuf/map.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.map)                                                                                                                    | 定义了map容器以及protobuf map支持。                                                                                                                                                                                                                                                                            |
| [google/protobuf/message.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.message)                                                                                                            | 定义[消息](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.message#Message)，非liteprotocol消息对象的抽象接口实现。                                                                                                                                                          |
| [google/protobuf/message_lite.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.message_lite)                                                                                                  | 定义[轻量消息](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.message_lite#MessageLite)，所有（包括轻量和非清理）protocol消息对象的抽象接口实现。                                                                                                                           |
| [google/protobuf/repeated_field.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.repeated_field)                                                                                              | 供生成的protocol消息类使用[RepeatedField](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.repeated_field#RepeatedField)和[RepeatedPtrField](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.repeated_field#RepeatedPtrField)操作重复字段。 |
| [google/protobuf/service.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.service)                                                                                                            | 弃用：该模块声明了proto2底层RPC服务的抽象接口。                                                                                                                                                                                                                                                                |
| [google/protobuf/text_format.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.text_format)                                                                                                    | 以可读的方式 --- text-based方式输出和解析protocol消息工具。                                                                                                                                                                                                                                                    |
| [google/protobuf/unknown_field_set.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.unknown_field_set)                                                                                        | 包含用于跟踪在解析protocol消息时遇到的未识别字段的类。                                                                                                                                                                                                                                                         |
| [google/protobuf/stubs/common.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.common)                                                                                                        | 包含库中其它部分使用的基本类型和工具。                                                                                                                                                                                                                                                                         |

### google::protobuf::io  

I/O操作辅助类。  

Protocol Buffer库使用包中类来处理原始字节的I/O和编解码操作。大多数使用者并不需要知道包的实现细节。然而，当用户想要适配他们自己的I/O --- 例如，想要在不使用临时缓存的情况下从不同的输入流中读取Protocol Buffer，这样的用户需要详细了解实现细节。  

| 文件                                                                                                                                                     | 说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| :------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [google/protobuf/io/coded_stream.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.io.coded_stream)                   | 这个文件包含[CodedInputStream](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.io.coded_stream#CodedInputStream)和[CodedOutputStream](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.io.coded_stream#CodedOutputStream)类，它们分别包装一个[ZeroCopyInputStream](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.io.zero_copy_stream#ZeroCopyInputStream)或[ZeroCopyOutputStream](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.io.zero_copy_stream#ZeroCopyOutputStream)，并允许您以各种格式读取或写入单个数据片段。 |
| [google/protobuf/io/printer.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.io.printer)                             | 将text内容写入[ZeroCopyOutputStream](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.io.zero_copy_stream#ZeroCopyOutputStream)的工具类。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| [google/protobuf/io/tokenizer.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.io.tokenizer)                         | 从[ZeroCopyInputStream](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.io.zero_copy_stream#ZeroCopyInputStream)解析标记化的text类。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| [google/protobuf/io/zero_copy_stream.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.io.zero_copy_stream)           | 包含[ZeroCopyInputStream](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.io.zero_copy_stream#ZeroCopyInputStream)或[ZeroCopyOutputStream](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.io.zero_copy_stream#ZeroCopyOutputStream)，可用来表示抽象的I/O流和读写Protocol Buffer。                                                                                                                                                                                                                                                                                                           |
| [google/protobuf/io/zero_copy_stream_impl.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.io.zero_copy_stream_impl) | 包含在[zero_copy_stream.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.io.zero_copy_stream)中定义的接口的实现，仅包括在完整的protobuf库中。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

### google::protobuf::util  

工具类，其中包括许多工具，可用于消息比对、JSON转换以及其它已知类型等。  

| 文件                                                                                                                                                     | 说明                                                          |
| :------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------ |
| [google/protobuf/util/field_comparator.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.util.field_comparator)       | 定义了用于字段对比的类。                                      |
| [google/protobuf/util/field_mask_util.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.util.field_mask_util)         | 定义FieldMask已知类型的工具。                                 |
| [[google/protobuf/util/json_util.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.util.json_util)                    | 定义了在protocol二进制格式与proto3 JSON格式间转换的工具函数。 |
| [google/protobuf/util/message_differencer.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.util.message_differencer) | 定义了用于比较Protocol消息的静态函数和方法。                  |
| [google/protobuf/util/time_util.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.util.time_util)                     | 定义了用于时间戳和时长的工具函数。                            |
| [google/protobuf/util/type_resolver.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.util.type_resolver)             | 为*所有消息*定义了*Type Resolver*。                           |
| [google/protobuf/util/type_resolver_util.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.util.type_resolver_util)   | 定义了*TypeResolver*工具。                                    |

### google::protobuf::compiler  

Protocol Buffer编译器的实现，其中包含了解析`.proto`文件的代码以及基于`.proto`文件生成代码的代码。你可能因为以下两个原因而对这个包感兴趣：  

- 在运行时你想要解析`.proto`文件。这种情况下，你用过翻阅[importer.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.importer)。由于这个功能应用很广泛，所以它被包含在libprotobuf的基本库里；这样你就不必链接libprotoc。
- 你要实现一个自定义的protocol编译器来生成不同的代码，比如说官方编译器不支持的编程语言。为此，[command_line_interface.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.command_line_interface)为你提供了完整的编译器前端，所以你要做的就是编写[CodeGenerator](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.code_generator#CodeGenerator)的自定义实现以及一个简单的`main()`函数。你甚至可以让你的编译器支持你自己编写的语言。由于这些功能只适用于那些要自己编写编译器的人，所以它们位于你必须链接的名为`libprotoc`的特定库中。  

| 文件                                                                                                                                                                          | 说明                                                                         |
| :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------- |
| [google/protobuf/compiler/code_generator.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.code_generator)                        | 定义了每个特定语言的代码生成器要实现的的抽象接口。                           |
| [google/protobuf/compiler/command_line_interface.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.command_line_interface)        | Protocol编译器的前端实现，这样它可以在用来支持其它语言的自定义编译器中复用。 |
| [google/protobuf/compiler/importer.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.importer)                                    | `.proto`文件解析器公共接口。                                                 |
| [google/protobuf/compiler/parser.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.parser)                                        | 实现将`.proto`文件解析为`FileDescriptorProtos`。                             |
| [google/protobuf/compiler/plugin.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.plugin)                                        | 由C++编写的protoc代码生成插件的前端。                                        |
| [google/protobuf/compiler/plugin.pb.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.plugin.pb)                                  | protoc插件的API。                                                            |
| [google/protobuf/compiler/cpp/cpp_generator.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.cpp_generator)                      | 为给定的`.proto`文件生成C++代码。                                            |
| [google/protobuf/compiler/csharp/csharp_generator.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.csharp_generator)             | 为给定的`.proto`文件生成C#代码。                                             |
| [google/protobuf/compiler/csharp/csharp_names.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.csharp_names)                     | 提供一种机制，用来将描述符映射为对应的C#类的完整名称。                       |
| [google/protobuf/compiler/java/java_generator.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.java_generator)                   | 为给定的`.proto`文件生成Java代码。                                           |
| [google/protobuf/compiler/java/java_names.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.java_names)                           | 提供一种机制，用来将描述符映射为对应的Java类的完整名称。                     |
| [google/protobuf/compiler/js/js_generator.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.js_generator)                         | 为给定的`.proto`文件生成JavaScript代码。                                     |
| [google/protobuf/compiler/objectivec/objectivec_generator.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.objectivec_generator) | 为给定的`.proto`文件生成ObjectiveC代码。                                     |
| [google/protobuf/compiler/objectivec/objectivec_helpers.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.objectivec_helpers)     | 生成ObjectiveC代码的帮助函数。                                               |
| [google/protobuf/compiler/python/python_generator.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.python_generator)             | 为给定的`.proto`文件生成Python代码。                                         |
| [google/protobuf/compiler/ruby/ruby_generator.h](https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.compiler.ruby_generator)                   | 为给定的`.proto`文件生成Ruby代码。                                           |  

---

> 声明：本作品采用[署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)进行许可，使用时请注明出处。  
> Author: mengbin92  
> Github: [mengbin92](https://mengbin92.github.io/)  
> cnblogs: [恋水无意](https://www.cnblogs.com/lianshuiwuyi/)  

---
