---
layout: post
title: Golang slice简介
tags: go
mermaid: false
math: false
---  

## 简介

Go语言中的切片（slice）是一种灵活的数据结构，它构建在数组之上并提供了方便的方式来操作数组的一部分。切片的底层实现涉及到数组和一些元数据。以下是Golang切片的底层实现的详细介绍：

1. **底层数组（Underlying Array）**：
   - 切片是建立在一个底层数组之上的。这个数组通常比切片的容量大，以容纳未来可能的元素。
   - 当你创建一个切片时，Go会自动为你创建一个底层数组，并将切片与该数组关联。
   - 底层数组的容量是不变的，而切片的长度可以变化。

2. **切片结构体（Slice Struct）**：
   - 切片实际上是一个结构体，包含了三个字段：指向底层数组的指针、切片的长度和切片的容量。
   - Go中的切片结构体定义如下：
     ```go
     type []T struct {
         ptr      *T // 指向底层数组的指针
         len, cap int // 长度和容量
     }
     ```

3. **切片的长度和容量**：
   - 切片的长度是当前切片中的元素数量。
   - 切片的容量是底层数组中可以容纳的元素数量，通常是从切片的起始位置到底层数组的末尾的元素数量。

4. **切片的操作**：
   - 切片支持通过索引访问元素、追加元素、截取子切片等操作。
   - 当切片的长度超过容量时，Go会自动创建一个新的底层数组，将数据复制到新数组中，以扩展切片的容量。

5. **切片的引用**：
   - 切片是引用类型，这意味着多个切片可以引用同一个底层数组，而不需要复制数据。

6. **切片的底层实现优势**：
   - 切片的底层实现使得它们非常高效，因为它们共享底层数据，不需要大量的内存复制。
   - 切片的动态增长是自动处理的，使得编程更加方便。

## slice扩容

切片（slice）是一种动态数组，它可以自动扩容以适应存储更多元素。切片的扩容过程如下：

1. 初始分配：当你创建一个切片时，Go会分配一个固定大小的底层数组，通常比你请求的切片容量要大一些，以留出一些额外的空间。这个额外的空间有助于切片的动态扩容。
2. 容量不足：当你向切片追加元素时，如果元素的数量超过了切片的容量（使用`cap()`函数可以查看切片的容量），Go会执行扩容操作。
3. 扩容策略：Go使用一种策略来决定新的容量，通常是当前容量的2倍。这意味着如果切片的容量不足，Go会分配一个更大的底层数组，并将已有的元素复制到新数组中。
4. 复制数据：扩容过程中，Go会将旧的元素逐个复制到新的底层数组中。
5. 返回新切片：一旦复制完成，Go会返回一个新的切片，该切片的容量已经增加，可以容纳更多的元素。

尽管Go语言的切片扩容策略是非常高效的，它允许开发者方便地操作动态数组，而不必过多关心内存管理。但需要注意，由于扩容可能导致数据复制，过于频繁的追加操作可能会产生性能开销，因此在性能敏感的场景中，应提前估算好切片的容量，以减少不必要的扩容操作。  

---

<div align="center">
  <img src="../img/qrcode_wechat.jpg" alt="孟斯特">
</div>

> 声明：本作品采用[署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)进行许可，使用时请注明出处。  
> Author: [mengbin](mengbin1992@outlook.com)  
> blog: [mengbin](https://mengbin.top)  
> Github: [mengbin92](https://mengbin92.github.io/)  
> cnblogs: [恋水无意](https://www.cnblogs.com/lianshuiwuyi/)  

---
